{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLTAGE WEB // SYSTEM V4.1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --voltage-yellow: #FCEE09;
            --voltage-dim: #8a8200;
            --void-black: #050505;
            --panel-grey: #111111;
            --electric-blue: #00f0ff;
            --neon-red: #ff003c;
            --font-head: 'Orbitron', sans-serif;
            --font-code: 'Share Tech Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; cursor: crosshair; }
        body { background-color: var(--void-black); color: #e0e0e0; font-family: var(--font-code); overflow-x: hidden; line-height: 1.6; }

        /* --- SCANLINES --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px; z-index: 999; pointer-events: none;
            animation: scroll 10s linear infinite;
        }

        /* --- TYPOGRAPHY --- */
        h1,h2,h3 { font-family: var(--font-head); text-transform: uppercase; letter-spacing: 2px; }
        .glitch-text {
            position: relative; color: var(--voltage-yellow); font-size: 4rem; font-weight: 900;
            text-shadow: 2px 2px 0px var(--electric-blue); opacity: 0; animation: reveal 0.1s forwards;
        }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--void-black); opacity: 0.8; pointer-events: none;
        }
        .glitch-text::before {
            left: 2px; text-shadow: -1px 0 red; clip-path: inset(0 0 0 0);
            animation: glitch-anim-1 2s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            left: -2px; text-shadow: -1px 0 var(--electric-blue); clip-path: inset(0 0 0 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        @keyframes reveal { to { opacity: 1; } }
        @keyframes glitch-anim-1 { 0% {clip-path: inset(20% 0 80% 0);} 20% {clip-path: inset(60% 0 10% 0);} 40% {clip-path: inset(40% 0 50% 0);} 60% {clip-path: inset(80% 0 5% 0);} 80% {clip-path: inset(10% 0 60% 0);} 100% {clip-path: inset(30% 0 30% 0);} }
        @keyframes glitch-anim-2 { 0% {clip-path: inset(10% 0 60% 0);} 20% {clip-path: inset(30% 0 20% 0);} 40% {clip-path: inset(70% 0 10% 0);} 60% {clip-path: inset(20% 0 50% 0);} 80% {clip-path: inset(50% 0 30% 0);} 100% {clip-path: inset(0% 0 80% 0);} }

        /* --- LAYOUT --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; position: relative; z-index: 2; }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid var(--voltage-dim); }

        .logo {
            font-family: var(--font-head); font-weight: 700; color: white; border: 1px solid var(--voltage-yellow);
            padding: 5px 15px; background: rgba(252, 238, 9, 0.1); transition: 0.3s;
            cursor: pointer !important; user-select: none;
        }
        .logo:hover {
            box-shadow: 0 0 15px var(--voltage-yellow); text-shadow: 0 0 5px white; background: rgba(252, 238, 9, 0.3);
        }

        .nav-links { display: flex; align-items: center; }
        .nav-links button, .nav-links a { background: none; border: none; color: #888; font-family: var(--font-code); margin-left: 30px; font-size: 1.1rem; transition: 0.3s; cursor: pointer; text-decoration: none; }
        .nav-links button:hover, .nav-links a:hover, .nav-links button.active { color: var(--voltage-yellow); text-shadow: 0 0 10px var(--voltage-yellow); }

        #btn-get-started { border: 1px solid var(--electric-blue); padding: 5px 15px; color: var(--electric-blue) !important; }
        #btn-get-started:hover { background: rgba(0,240,255,0.1); }

        .user-profile { display: flex; align-items: center; margin-left: 30px; gap: 10px; }
        .user-profile img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--voltage-yellow); box-shadow: 0 0 10px var(--voltage-yellow); }
        .user-profile span { color: var(--voltage-yellow); font-size: 0.9rem; }

        .hidden { display: none !important; }

        .view-section { display: none; animation: fadeIn 0.5s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        .hero { height: 60vh; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; }
        .scramble-target { display: inline-block; min-width: 10px; }
        .hero-sub { color: var(--electric-blue); margin-bottom: 1rem; display: block; font-size: 1.2rem; }
        .btn-group { margin-top: 2rem; display: flex; gap: 1rem; }
        .btn-voltage { padding: 15px 40px; background: transparent; border: 2px solid var(--voltage-yellow); color: var(--voltage-yellow); font-family: var(--font-head); font-weight: 700; text-transform: uppercase; font-size: 1rem; transition: 0.3s; overflow: hidden; }
        .btn-voltage:hover { background: var(--voltage-yellow); color: var(--void-black); box-shadow: 0 0 30px var(--voltage-yellow); }
        .btn-voltage.secondary { border-color: var(--electric-blue); color: var(--electric-blue); }
        .btn-voltage.secondary:hover { background: var(--electric-blue); color: var(--void-black); box-shadow: 0 0 30px var(--electric-blue); }

        .grid-section { display: grid; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); gap: 2rem; margin-top:2rem; margin-bottom:4rem; }
        .card { background: var(--panel-grey); border:1px solid #333; padding:2rem; position:relative; transition:0.3s; }
        .card::before { content:''; position:absolute; top:0; left:0; width:100%; height:2px; background: var(--voltage-yellow); transform:scaleX(0); transform-origin:left; transition: transform 0.4s ease; }
        .card:hover { transform: translateY(-5px); border-color: var(--voltage-yellow); box-shadow: 0 10px 30px -10px rgba(252,238,9,0.15); }
        .card:hover::before { transform: scaleX(1); }
        .card h3 { color:white; margin-bottom:1rem; }
        .card p { color:#888; font-size:0.9rem; }

        .market-header { margin-top:2rem; margin-bottom:2rem; border-left:4px solid var(--voltage-yellow); padding-left:20px; }
        .crypto-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:1.5rem; margin-top:2rem; }
        .crypto-card { background: rgba(17,17,17,0.8); border:1px solid #333; padding:1.5rem; transition:0.3s; }
        .crypto-card:hover { border-color: var(--voltage-yellow); transform:translateY(-5px); box-shadow: 0 0 20px rgba(252,238,9,0.1); }
        .coin-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
        .coin-symbol { font-family: var(--font-head); color: var(--voltage-yellow); font-size:1.5rem; }
        .coin-name { color:#666; font-size:0.9rem; }
        .coin-price { font-size:2rem; color:white; margin-bottom:0.5rem; font-weight:bold; }
        .coin-change { font-size:1.1rem; padding:2px 8px; border-radius:4px; display:inline-block; }
        .positive { color: var(--void-black); background: var(--electric-blue); }
        .negative { color:white; background: var(--neon-red); }

        footer { text-align:center; padding:3rem; border-top:1px solid #222; color:#555; font-size:0.8rem; margin-top:4rem;}

        .btn-logout { background: none; border: none; font-family: var(--font-code); font-size: 0.8rem; color: var(--neon-red); cursor: pointer; margin-left: 10px; }
        .btn-logout:hover { text-shadow: 0 0 5px var(--neon-red); }

        /* --- VOLT-SWAP CONVERTER STYLES --- */
        .converter-container {
            background: rgba(20, 20, 20, 0.9); border: 1px solid var(--voltage-dim); padding: 1.5rem;
            margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;
        }
        .converter-title { font-family: var(--font-head); color: var(--electric-blue); margin-right: auto; }
        .volt-input, .volt-select {
            background: black; border: 1px solid #444; color: var(--voltage-yellow);
            padding: 10px; font-family: var(--font-code); font-size: 1rem; outline: none;
        }
        .volt-input:focus, .volt-select:focus { border-color: var(--voltage-yellow); }
        .conversion-result { font-size: 1.5rem; font-weight: bold; color: white; min-width: 150px; text-align: right; }

        /* --- INFINITE SLIDER --- */
        .slider-container {
            margin-top: 4rem; margin-bottom: 2rem; overflow: hidden; position: relative;
            border-top: 1px solid #333; border-bottom: 1px solid #333; background: rgba(10, 10, 10, 0.5); padding: 2rem 0;
        }
        .slider-container::before, .slider-container::after {
            content: ""; position: absolute; top: 0; width: 150px; height: 100%; z-index: 2; pointer-events: none;
        }
        .slider-container::before { left: 0; background: linear-gradient(to right, var(--void-black), transparent); }
        .slider-container::after { right: 0; background: linear-gradient(to left, var(--void-black), transparent); }
        .slider-track { display: flex; gap: 2rem; width: max-content; animation: scroll-left 40s linear infinite; }
        .slider-container:hover .slider-track { animation-play-state: paused; }
        .slide-card {
            min-width: 300px; background: var(--panel-grey); border: 1px solid #333; border-left: 3px solid var(--electric-blue);
            padding: 1.5rem; display: flex; flex-direction: column; justify-content: center; transition: 0.3s; user-select: none;
        }
        .slide-card:hover { border-color: var(--voltage-yellow); box-shadow: 0 0 15px rgba(252, 238, 9, 0.1); transform: scale(1.02); }
        .slide-title { color: var(--voltage-yellow); font-family: var(--font-head); font-size: 1.1rem; margin-bottom: 0.5rem; }
        .slide-desc { color: #888; font-size: 0.9rem; }
        @keyframes scroll-left { to { transform: translateX(-50%); } }

        /* --- TELEMETRY DASHBOARD STYLES --- */
.telemetry-section { margin-top: 4rem; margin-bottom: 4rem; }

.section-header {
    display: flex; justify-content: space-between; align-items: flex-end;
    border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px;
}

.live-indicator {
    color: var(--electric-blue); font-size: 0.8rem; font-family: var(--font-code);
    display: flex; align-items: center; gap: 5px;
}
.blink { animation: blinker 1.5s linear infinite; color: var(--neon-red); }
@keyframes blinker { 50% { opacity: 0; } }

.telemetry-grid {
    display: grid;
    grid-template-columns: 2fr 1fr; /* 2 Columns: Wide Chart vs Side Panels */
    grid-template-rows: auto auto;
    gap: 20px;
}

/* Responsive fix for mobile */
@media(max-width: 900px) {
    .telemetry-grid { grid-template-columns: 1fr; }
}

.tele-card {
    background: rgba(10, 10, 10, 0.6);
    border: 1px solid #333;
    padding: 20px;
    position: relative;
}
/* Cyberpunk Corner Accents */
.tele-card::after {
    content: ''; position: absolute; bottom: 0; right: 0;
    width: 20px; height: 20px;
    border-bottom: 2px solid var(--voltage-yellow);
    border-right: 2px solid var(--voltage-yellow);
}

.tele-card.wide { grid-row: span 2; } /* Main chart takes full height */

.card-top { display: flex; justify-content: space-between; margin-bottom: 15px; }
.card-top h3 { color: #888; font-size: 0.9rem; font-family: var(--font-code); letter-spacing: 1px; }

.legend span { margin-left: 10px; font-size: 0.8rem; font-weight: bold; }

.chart-wrapper { position: relative; height: 300px; width: 100%; }

/* Stock List Styling */
.hot-list { list-style: none; padding: 0; margin: 0; }
.hot-list li {
    display: flex; justify-content: space-between; padding: 10px 0;
    border-bottom: 1px dashed #222; font-family: var(--font-code); font-size: 0.9rem;
}
.hot-list li:last-child { border-bottom: none; }
.ticker { color: white; font-weight: bold; width: 60px; }
.price { color: #aaa; text-align: right; flex: 1; margin-right: 20px; }
.change { width: 60px; text-align: right; }
.pos { color: var(--electric-blue); text-shadow: 0 0 5px rgba(0,240,255,0.4); }
.neg { color: var(--neon-red); text-shadow: 0 0 5px rgba(255,0,60,0.4); }
    </style>
</head>
<body>
<div class="scanlines"></div>

<div class="container">
    <nav>
        <!-- The onclick here triggers the function inside side_panel.html -->
        <div class="logo" onclick="toggleSidePanel()" title="Click to open menu"> INFO </div>

        <div class="nav-links">
            <button onclick="switchView('home')" id="btn-home" class="active">_HOME</button>
            <button onclick="switchView('market')" id="btn-market">_STOCKMARKET</button>

            {% if user.is_authenticated %}
                <div class="user-profile">
                    <span id="username-display">{{ user.first_name|default:user.username|upper }}</span>
                    {% if user.socialaccount_set.all.0.get_avatar_url %}
                        <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" alt="User Profile">
                    {% else %}
                        <div style="width:40px;height:40px;border-radius:50%;border:2px solid var(--voltage-yellow);display:flex;align-items:center;justify-content:center;color:var(--voltage-yellow);font-weight:bold;">V</div>
                    {% endif %}
                    <form method="post" action="{% url 'account_logout' %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn-logout">[X]</button>
                    </form>
                </div>
            {% else %}
                <a href="{% url 'login' %}" id="btn-get-started">Get Started</a>
            {% endif %}
        </div>
    </nav>

    <!-- HOME VIEW -->
    <div id="home-view" class="view-section active">
        <header class="hero">
            <span class="hero-sub scramble-target" data-value="> INITIALIZING SEQUENCE...">> INITIALIZING SEQUENCE...</span>
            <h1 class="glitch-text scramble-target" data-value="CRYPTO MARKET" data-text="CRYPTO MARKET">CRYPTO MARKET</h1>
            <h1 class="scramble-target" style="font-size:2.5rem;opacity:0.8;" data-value="3000 COIN " data-text="3000 COIN">3000 COINS</h1>
            <p style="max-width:500px;margin-top:1rem;color:#aaa;">Raw energy infrastructure for the decentralized web. Unfiltered access. Maximum throughput.</p>
            <div class="btn-group">
                <button class="btn-voltage" onclick="switchView('market')">Initialize Market Feed</button>
                <button class="btn-voltage secondary" id="wallet-btn" onclick="connectWallet()">Connect Wallet</button>
            </div>
        </header>

        <section class="grid-section">
            <div class="card"><h3>01. OVERCLOCK</h3><p>Pushing hardware limits beyond safety protocols.</p></div>
            <div class="card"><h3>02. NEURAL LINK</h3><p>Direct interface connection established.</p></div>
            <div class="card"><h3>03. BLACKOUT</h3><p>Stealth mode engaged. Military-grade encryption.</p></div>
            <div class="card"><h3>04. CRYPTO ONLINE STOCKMARKET</h3><p>Operate in the online stockmarket of crypto currencies with encryption and signal masking.</p></div>
            <div class="card"><h3>05. UCL NIGHT</h3><p> BARCA V CHELSEA. 21:00 TONIGHT.</p></div>
            <div class="card"><h3>06. BLACKIN</h3><p>Stealth mode dengaged. Military non grade decryption.</p></div>
        </section>

        <!-- ============================================== -->
<!-- NEW SECTION: MARKET INTELLIGENCE DASHBOARD     -->
<!-- ============================================== -->
<section class="telemetry-section">
    <div class="section-header">
        <h2 class="glitch-header" data-text="LIVE TELEMETRY // HYBRID ASSETS">LIVE TELEMETRY // HYBRID ASSETS</h2>
        <div class="live-indicator">
            <span class="blink">●</span> SYSTEM LIVE
        </div>
    </div>

    <div class="telemetry-grid">
        <!-- LEFT: MAIN HYBRID CHART -->
        <div class="tele-card wide">
            <div class="card-top">
                <h3>> CROSS-MARKET CORRELATION</h3>
                <div class="legend">
                    <span style="color:var(--voltage-yellow)">BTC</span>
                    <span style="color:var(--electric-blue)">NVDA</span>
                    <span style="color:var(--neon-red)">SPX</span>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="hybridChart"></canvas>
            </div>
        </div>

        <!-- RIGHT TOP: SENTIMENT RADAR -->
        <div class="tele-card square">
            <div class="card-top">
                <h3>> MARKET SENTIMENT</h3>
            </div>
            <div class="chart-wrapper">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <!-- RIGHT BOTTOM: HOT LIST -->
        <div class="tele-card square list-card">
            <div class="card-top">
                <h3>> TRENDING TICKERS</h3>
            </div>
            <ul class="hot-list">
                <li>
                    <span class="ticker">NVDA</span>
                    <span class="price">$1,140.22</span>
                    <span class="change pos">+2.4%</span>
                </li>
                <li>
                    <span class="ticker">SOL</span>
                    <span class="price">$145.50</span>
                    <span class="change neg">-1.2%</span>
                </li>
                <li>
                    <span class="ticker">TSLA</span>
                    <span class="price">$178.00</span>
                    <span class="change pos">+0.8%</span>
                </li>
                <li>
                    <span class="ticker">PEPE</span>
                    <span class="price">$0.0001</span>
                    <span class="change pos">+12.0%</span>
                </li>
            </ul>
        </div>
    </div>
</section>

        <!-- INFINITE INFO SLIDER -->
        <div class="slider-container">
            <div class="slider-track" id="infinite-track">
                <div class="slide-card">
                    <div class="slide-title">> INSTANT EXECUTION</div>
                    <div class="slide-desc">Latency < 0.05ms. Optical fiber connection to global exchanges.</div>
                </div>
                <div class="slide-card" style="border-left-color: var(--neon-red);">
                    <div class="slide-title">> ZERO FEES</div>
                    <div class="slide-desc">No transaction costs on standard protocols. 100% decentralized.</div>
                </div>
                <div class="slide-card">
                    <div class="slide-title">> DEEP LIQUIDITY</div>
                    <div class="slide-desc">Access to multi-billion dollar pools across 50+ networks.</div>
                </div>
                <div class="slide-card" style="border-left-color: var(--voltage-yellow);">
                    <div class="slide-title">> 24/7 SUPPORT</div>
                    <div class="slide-desc">AI-driven assistance + human operator backup nodes.</div>
                </div>
                <div class="slide-card">
                    <div class="slide-title">> MILITARY GRADE</div>
                    <div class="slide-desc">AES-256 Encryption standard. Your data is untouchable.</div>
                </div>
                 <div class="slide-card" style="border-left-color: var(--electric-blue);">
                    <div class="slide-title">> API ACCESS</div>
                    <div class="slide-desc">Full developer documentation for algorithmic trading bots.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MARKET VIEW -->
    <div id="market-view" class="view-section">
        <div class="market-header">
            <h2>LIVE FEED // GLOBAL MARKETS</h2>
            <p style="color: var(--electric-blue)">> ESTABLISHING SECURE CONNECTION...</p>
        </div>

        <!-- VOLT-SWAP CONVERTER -->
        <div class="converter-container">
            <div class="converter-title">// VOLT-SWAP CONVERTER</div>
            <input type="number" id="swap-amount" class="volt-input" placeholder="0.00" value="1" oninput="calculateSwap()">
            <select id="swap-select" class="volt-select" onchange="calculateSwap()">
                <option value="" disabled selected>SELECT ASSET</option>
            </select>
            <div style="color: #666;">=</div>
            <div id="swap-result" class="conversion-result">$0.00</div>
        </div>

        <!-- ANALYTICS DASHBOARD -->
        <div class="analytics-container" style="display: flex; gap: 2rem; flex-wrap: wrap; margin-bottom: 3rem;">
            <div style="flex: 1; min-width: 300px; background: rgba(10,10,10,0.8); border: 1px solid #333; padding: 1rem; position: relative;">
                <h3 style="color: var(--electric-blue); font-size: 1rem; margin-bottom: 10px;">// TOP GAINERS (24H)</h3>
                <canvas id="gainersChart"></canvas>
            </div>
            <div style="flex: 1; min-width: 300px; background: rgba(10,10,10,0.8); border: 1px solid #333; padding: 1rem; position: relative;">
                <h3 style="color: var(--neon-red); font-size: 1rem; margin-bottom: 10px;">// TOP LOSERS (24H)</h3>
                <canvas id="losersChart"></canvas>
            </div>
        </div>

        <div id="crypto-container" class="crypto-grid">
            <div class="loading-text" style="color: var(--electric-blue);">Scanning Network...</div>
        </div>
    </div>
</div>

<footer><p>VOLTAGE WEB © 2077 // DATA PROVIDED BY COINGECKO API</p></footer>

<!-- ============================================== -->
<!-- INCLUDE SIDE PANEL COMPONENT HERE              -->
<!-- ============================================== -->
{% include 'side_panel.html' %}


<script>
// --- GLOBAL VARIABLES ---
let marketData = [];
let gainersChartInstance = null;
let losersChartInstance = null;
const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*";

// --- MAIN ENTRY POINT ---
window.onload = () => {
    // 1. Initialize Scrambles
    document.querySelectorAll(".scramble-target").forEach(el => {
        runScramble(el);
        el.addEventListener('mouseenter', () => runScramble(el));
    });

    // 2. Initialize Infinite Slider Loop
    const track = document.getElementById('infinite-track');
    if(track) {
        const content = track.innerHTML;
        track.innerHTML = content + content;
    }

    // 3. Initialize Telemetry Charts (Call directly here)
    initTelemetryCharts();
};

// --- TELEMETRY CHARTS FUNCTION ---
function initTelemetryCharts() {
    console.log("Initializing Telemetry Charts..."); // Debug check

    // 1. CHART: Cross-Market Correlation (Line)
    const canvasHybrid = document.getElementById('hybridChart');
    if(canvasHybrid) {
        const ctxHybrid = canvasHybrid.getContext('2d');

        // Generate some fake "techy" looking data
        const labels = Array.from({length: 20}, (_, i) => i + ':00');
        const dataBTC = Array.from({length: 20}, () => Math.floor(Math.random() * 50) + 100);
        const dataNVDA = Array.from({length: 20}, () => Math.floor(Math.random() * 30) + 80);
        const dataSPX = Array.from({length: 20}, () => Math.floor(Math.random() * 20) + 60);

        new Chart(ctxHybrid, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'BTC',
                        data: dataBTC,
                        borderColor: '#FCEE09', // Voltage Yellow
                        backgroundColor: 'rgba(252, 238, 9, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: 'NVDA',
                        data: dataNVDA,
                        borderColor: '#00f0ff', // Electric Blue
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: 'SPX',
                        data: dataSPX,
                        borderColor: '#ff003c', // Neon Red
                        borderWidth: 1,
                        borderDash: [5, 5], // Dashed line
                        tension: 0.4,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: '#222' }, ticks: { display: false } },
                    y: { grid: { color: '#222' }, ticks: { color: '#555', font: { family: "'Share Tech Mono'" } } }
                },
                animation: { duration: 2000, easing: 'easeOutQuart' }
            }
        });
    }

    // 2. CHART: Sentiment Radar (Spider Chart)
    const canvasRadar = document.getElementById('radarChart');
    if(canvasRadar) {
        const ctxRadar = canvasRadar.getContext('2d');
        new Chart(ctxRadar, {
            type: 'radar',
            data: {
                labels: ['VOLATILITY', 'VOLUME', 'GREED', 'FOMO', 'WHALE ACT.'],
                datasets: [{
                    label: 'Current Status',
                    data: [85, 60, 90, 45, 75],
                    backgroundColor: 'rgba(0, 240, 255, 0.2)',
                    borderColor: '#00f0ff',
                    pointBackgroundColor: '#00f0ff',
                    pointBorderColor: '#fff',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    r: {
                        angleLines: { color: '#333' },
                        grid: { color: '#333' },
                        pointLabels: { color: '#888', font: { size: 10, family: "'Share Tech Mono'" } },
                        ticks: { display: false, backdropColor: 'transparent' }
                    }
                }
            }
        });
    }
}

// --- TEXT SCRAMBLE EFFECT ---
function runScramble(element, speed = 3) {
    let iteration = 0;
    const originalText = element.dataset.value;
    clearInterval(element.interval);
    element.interval = setInterval(() => {
        element.innerText = originalText.split("").map((letter,index)=>{
            if(index<iteration) return originalText[index];
            return letters[Math.floor(Math.random()*letters.length)];
        }).join("");
        if(iteration>=originalText.length) clearInterval(element.interval);
        iteration += 1/speed;
    },30);
}

// --- VIEW SWITCHING LOGIC ---
function switchView(viewName) {
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-links button, .nav-links a').forEach(el => el.classList.remove('active'));

    if(viewName === 'home') {
        document.getElementById('home-view').classList.add('active');
        document.getElementById('btn-home').classList.add('active');
        document.querySelectorAll(".scramble-target").forEach(el => runScramble(el));
    } else if(viewName === 'market') {
        document.getElementById('market-view').classList.add('active');
        document.getElementById('btn-market').classList.add('active');

        if(marketData.length === 0) {
            fetchCryptoData();
        }
    }
}

// --- WALLET CONNECT LOGIC ---
function connectWallet() {
    const btn = document.getElementById('wallet-btn');

    // 1. Visual Hacking Effect
    btn.innerHTML = "INITIALIZING...";
    btn.style.borderColor = "var(--electric-blue)";
    btn.style.color = "var(--electric-blue)";

    let dots = 0;
    const interval = setInterval(() => {
        dots = (dots + 1) % 4;
        btn.innerHTML = "CONNECTING" + ".".repeat(dots);
    }, 300);

    // 2. Redirect after 1.5 seconds
    setTimeout(() => {
        clearInterval(interval);
        window.location.href = "{% url 'wallet_dashboard' %}";
    }, 1500);
}


// --- DATA FETCHING & ANALYTICS ---
async function fetchCryptoData() {
    const container = document.getElementById('crypto-container');

    if(container.children.length <= 1) {
         container.innerHTML = '<div class="loading-text" style="color: var(--electric-blue);">Scanning Network...</div>';
    }

    try {
        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false');

        if (!response.ok) throw new Error("API Limit Reached");

        const data = await response.json();
        marketData = data;

        populateConverter();
        renderAnalytics(data);

        container.innerHTML = '';
        data.slice(0, 12).forEach(coin => {
            const card = document.createElement('div');
            card.className = 'crypto-card';
            const changeClass = coin.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
            const changeSymbol = coin.price_change_percentage_24h >= 0 ? '+' : '';

            card.innerHTML = `
                <div class="coin-head">
                    <span class="coin-symbol">${coin.symbol.toUpperCase()}</span>
                    <span class="coin-name">${coin.name}</span>
                </div>
                <div class="coin-price">$${coin.current_price.toLocaleString()}</div>
                <div class="coin-change ${changeClass}">${changeSymbol}${coin.price_change_percentage_24h.toFixed(2)}%</div>`;
            container.appendChild(card);
        });

    } catch(err) {
        console.error(err);
        container.innerHTML = `<p style="color:var(--neon-red)">Connection Failed: API Limit Reached. <br><span style="font-size:0.8rem; color:#666">Wait 2 mins and refresh.</span></p>`;
    }
}

// --- MARKET CHART RENDERING ---
function renderAnalytics(data) {
    const sortedData = [...data].sort((a, b) => b.price_change_percentage_24h - a.price_change_percentage_24h);
    const topGainers = sortedData.slice(0, 5);
    const topLosers = sortedData.slice(-5).reverse();

    const commonOptions = {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
            x: {
                ticks: { color: '#888', font: { family: "'Share Tech Mono'" } },
                grid: { display: false }
            },
            y: {
                ticks: { color: '#888', font: { family: "'Share Tech Mono'" } },
                grid: { color: '#222' }
            }
        }
    };

    const ctxG = document.getElementById('gainersChart').getContext('2d');
    if(gainersChartInstance) gainersChartInstance.destroy();

    gainersChartInstance = new Chart(ctxG, {
        type: 'bar',
        data: {
            labels: topGainers.map(c => c.symbol.toUpperCase()),
            datasets: [{
                data: topGainers.map(c => c.price_change_percentage_24h),
                backgroundColor: '#00f0ff',
                borderColor: '#00f0ff',
                borderWidth: 1,
                shadowBlur: 10,
                shadowColor: '#00f0ff'
            }]
        },
        options: commonOptions
    });

    const ctxL = document.getElementById('losersChart').getContext('2d');
    if(losersChartInstance) losersChartInstance.destroy();

    losersChartInstance = new Chart(ctxL, {
        type: 'bar',
        data: {
            labels: topLosers.map(c => c.symbol.toUpperCase()),
            datasets: [{
                data: topLosers.map(c => c.price_change_percentage_24h),
                backgroundColor: '#ff003c',
                borderColor: '#ff003c',
                borderWidth: 1
            }]
        },
        options: commonOptions
    });
}

function populateConverter() {
    const select = document.getElementById('swap-select');
    if(!select) return;
    select.innerHTML = '<option value="" disabled selected>SELECT ASSET</option>';
    marketData.forEach(coin => {
        const option = document.createElement('option');
        option.value = coin.current_price;
        option.text = coin.symbol.toUpperCase();
        select.appendChild(option);
    });
}

function calculateSwap() {
    const amountInput = document.getElementById('swap-amount');
    const select = document.getElementById('swap-select');
    const resultBox = document.getElementById('swap-result');
    if(!amountInput || !select || !resultBox) return;

    const amount = parseFloat(amountInput.value);
    const price = parseFloat(select.value);

    if (!amount || !price) {
        resultBox.innerText = "$0.00";
        return;
    }
    const total = amount * price;
    resultBox.innerText = "$" + total.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
</script>
</body>
</html>